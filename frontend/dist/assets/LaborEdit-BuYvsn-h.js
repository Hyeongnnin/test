import{d as J,D as T,c as m,b as t,F as O,k as z,A as n,t as I,B as p,p as g,C as V,h as b,r as x,o as W,g as E,e as q,m as C,z as Y,I as G,v as H,w as K,J as P}from"./index-DamHdx69.js";import{u as Q,a as R}from"./MainLayout-B5bxgMFS.js";import{a as v}from"./api-DXNNeTpL.js";import{_ as X}from"./userStore-CiV_CRMt.js";const Z={class:"space-y-4"},ee={class:"grid grid-cols-1 gap-3"},te={class:"w-20 text-sm font-medium"},ae=["onUpdate:modelValue"],se=["onUpdate:modelValue"],le={class:"ml-2 inline-flex items-center gap-2 text-sm"},oe=["onUpdate:modelValue"],re=J({__name:"WeeklyScheduleEditor",props:{employeeId:{type:Number,required:!0}},setup(j){const d=j,f=[{value:0,label:"월"},{value:1,label:"화"},{value:2,label:"수"},{value:3,label:"목"},{value:4,label:"금"},{value:5,label:"토"},{value:6,label:"일"}],l=T({0:{start_time:null,end_time:null,enabled:!1},1:{start_time:null,end_time:null,enabled:!1},2:{start_time:null,end_time:null,enabled:!1},3:{start_time:null,end_time:null,enabled:!1},4:{start_time:null,end_time:null,enabled:!1},5:{start_time:null,end_time:null,enabled:!1},6:{start_time:null,end_time:null,enabled:!1}});async function $(){try{const a=await v.get(`/labor/jobs/${d.employeeId}/schedules/`);for(const o of a.data)l[o.weekday]={start_time:o.start_time,end_time:o.end_time,enabled:o.enabled}}catch(a){console.error("Failed to load schedules",a)}}async function U(){try{for(const a of f){const o={weekday:a.value,start_time:l[a.value].start_time,end_time:l[a.value].end_time,enabled:l[a.value].enabled?"1":"0"};await v.post(`/labor/jobs/${d.employeeId}/schedules/`,o)}alert("저장되었습니다.")}catch(a){console.error("Failed to save schedules",a),alert("저장 실패")}}function S(){for(const a of Object.keys(l))l[parseInt(a)].start_time=null,l[parseInt(a)].end_time=null,l[parseInt(a)].enabled=!1}return $(),(a,o)=>(b(),m("div",Z,[o[2]||(o[2]=t("p",{class:"text-sm text-gray-600"},"주간 근무 스케줄을 입력하세요. 각 요일에 대해 출근/퇴근 시간을 설정합니다.",-1)),t("div",ee,[(b(),m(O,null,z(f,u=>t("div",{key:u.value,class:"flex items-center gap-3"},[t("div",te,I(u.label),1),n(t("input",{type:"time","onUpdate:modelValue":_=>l[u.value].start_time=_,class:"px-2 py-1 border rounded"},null,8,ae),[[p,l[u.value].start_time]]),o[1]||(o[1]=t("span",{class:"text-xs text-gray-400"},"~",-1)),n(t("input",{type:"time","onUpdate:modelValue":_=>l[u.value].end_time=_,class:"px-2 py-1 border rounded"},null,8,se),[[p,l[u.value].end_time]]),t("label",le,[n(t("input",{type:"checkbox","onUpdate:modelValue":_=>l[u.value].enabled=_},null,8,oe),[[V,l[u.value].enabled]]),o[0]||(o[0]=g(" 활성 ",-1))])])),64))]),t("div",{class:"flex gap-2"},[t("button",{onClick:U,class:"px-4 py-2 bg-brand-600 text-white rounded"},"저장"),t("button",{onClick:S,class:"px-4 py-2 bg-gray-100 rounded"},"초기화")])]))}}),ne={class:"max-w-2xl mx-auto"},de={key:0,class:"mb-4 p-4 bg-brand-50 border border-brand-200 rounded-lg text-sm text-brand-700"},ie={class:"bg-white rounded-lg border border-gray-200 p-8 shadow-sm"},ue={class:"mb-6"},pe={class:"mb-6"},_e={class:"mb-6"},me={class:"mb-6"},be={class:"mb-6"},ye={class:"relative"},ce={class:"mb-6"},ge={class:"relative"},fe={class:"mb-6"},xe={class:"relative"},ve={class:"mb-6"},we={class:"mb-6"},ke={class:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200"},he={class:"flex items-center gap-3"},Ve={class:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200"},$e={class:"flex items-center gap-3"},Ue={class:"mb-8 p-4 bg-gray-50 rounded-lg border border-gray-200"},Se={class:"flex items-center gap-3"},Fe={class:"mb-6"},Ee={key:0,class:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg"},Ce={class:"text-red-700 text-sm"},Ie={class:"flex gap-3 justify-end"},je=["disabled"],De={key:0},Ne={key:1},Me={key:0,class:"fixed bottom-6 right-6 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg"},qe=J({__name:"LaborEdit",setup(j){const{activeJob:d,fetchJobs:f,setActiveJob:l}=Q(),{fetchJobSummary:$,getMonthString:U,fetchEvaluation:S}=R(),a=T({workplace_name:"",workplace_address:"",workplace_reg_no:"",industry:"",employment_type:"",start_date:"",end_date:"",hourly_rate:0,weekly_hours:0,daily_hours:0,has_paid_weekly_holiday:!0,is_severance_eligible:!1,is_current:!0,work_days_per_week:null,attendance_rate_last_year:null,total_wage_last_3m:null,total_days_last_3m:null}),o=x(!1),u=x(!1),_=x(null),w=x(null),F=x(!1);async function D(){var r,e;o.value=!0;try{if(d.value){const s=(await v.get(`/labor/employees/${d.value.id}/`)).data;a.workplace_name=s.workplace_name||"",a.workplace_address=s.workplace_address||"",a.workplace_reg_no=s.workplace_reg_no||"",a.industry=s.industry||"",a.employment_type=s.employment_type||"",a.start_date=s.start_date||"",a.end_date=s.end_date||"",a.hourly_rate=parseFloat(s.hourly_rate)||0,a.weekly_hours=parseFloat(s.weekly_hours)||0,a.daily_hours=parseFloat(s.daily_hours)||0,a.has_paid_weekly_holiday=s.has_paid_weekly_holiday??!0,a.is_severance_eligible=s.is_severance_eligible??!1,a.is_current=s.is_current??!0,a.work_days_per_week=s.work_days_per_week??null,a.attendance_rate_last_year=s.attendance_rate_last_year??null,a.total_wage_last_3m=s.total_wage_last_3m??null,a.total_days_last_3m=s.total_days_last_3m??null}else _.value=null}catch(i){_.value=((e=(r=i.response)==null?void 0:r.data)==null?void 0:e.detail)||"근로정보를 불러올 수 없습니다.",console.error("Failed to load form data:",i)}finally{o.value=!1}}function k(r){return String(r).padStart(2,"0")}function N(r){if(!r)return null;if(r=r.trim(),/^\d{4}-\d{2}-\d{2}$/.test(r))return r;const e=r.match(/(\d{4}).*?(\d{1,2}).*?(\d{1,2})/);if(e){const s=e[1],y=k(e[2]),c=k(e[3]);return`${s}-${y}-${c}`}const i=new Date(r);if(!isNaN(i.getTime())){const s=i.getFullYear(),y=k(i.getMonth()+1),c=k(i.getDate());return`${s}-${y}-${c}`}return null}async function L(){var r,e,i;w.value=null,u.value=!0;try{const s={workplace_name:a.workplace_name,workplace_address:a.workplace_address,workplace_reg_no:a.workplace_reg_no,industry:a.industry,employment_type:a.employment_type,hourly_rate:a.hourly_rate,weekly_hours:a.weekly_hours,daily_hours:a.daily_hours,has_paid_weekly_holiday:a.has_paid_weekly_holiday,is_severance_eligible:a.is_severance_eligible,is_current:a.is_current,work_days_per_week:a.work_days_per_week,attendance_rate_last_year:a.attendance_rate_last_year,total_wage_last_3m:a.total_wage_last_3m,total_days_last_3m:a.total_days_last_3m},y=N(a.start_date),c=N(a.end_date);if(s.start_date=y,s.end_date=c,d.value)await v.patch(`/labor/employees/${d.value.id}/`,s);else{const h=(await v.post("/labor/employees/",s)).data;await f(),h!=null&&h.id&&l(h.id)}F.value=!0,setTimeout(()=>{F.value=!1},3e3),await f();const A=U();d.value&&await $(d.value.id,A);try{d.value&&await S(d.value.id)}catch(M){console.warn("평가 결과 재조회 실패",M)}window.dispatchEvent(new CustomEvent("job-updated")),console.log("근로정보 저장 및 평가 갱신 완료")}catch(s){console.error("Failed to save employee data:",s);const y=(e=(r=s==null?void 0:s.response)==null?void 0:r.data)==null?void 0:e.detail,c=(i=s==null?void 0:s.response)!=null&&i.data&&typeof s.response.data=="object"?Object.values(s.response.data).flat().join(", "):"";w.value=y||c||"저장에 실패했습니다. 서버 연결 또는 인증을 확인해주세요."}finally{u.value=!1}}function B(){D()}return W(()=>{D()}),(r,e)=>{var i;return b(),m("div",ne,[e[32]||(e[32]=t("div",{class:"mb-6"},[t("h1",{class:"text-2xl font-bold text-gray-900 mb-2"},"근로정보 수정"),t("p",{class:"text-sm text-gray-600"},"현재 선택된 알바의 근로조건을 수정할 수 있습니다.")],-1)),C(d)?E("",!0):(b(),m("div",de," 현재 선택된 알바가 없습니다. 아래 폼을 작성하면 새 알바가 등록되고 자동으로 선택됩니다. ")),t("div",ie,[t("form",{onSubmit:Y(L,["prevent"])},[t("div",ue,[e[12]||(e[12]=t("label",{for:"workplace_name",class:"block text-sm font-semibold text-gray-900 mb-2"},[g(" 사업장명 "),t("span",{class:"text-red-500"},"*")],-1)),n(t("input",{id:"workplace_name","onUpdate:modelValue":e[0]||(e[0]=s=>a.workplace_name=s),type:"text",required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-transparent transition",placeholder:"예: Starbucks 강남점"},null,512),[[p,a.workplace_name]])]),t("div",pe,[e[13]||(e[13]=t("label",{for:"workplace_address",class:"block text-sm font-semibold text-gray-900 mb-2"}," 사업장 주소 ",-1)),n(t("input",{id:"workplace_address","onUpdate:modelValue":e[1]||(e[1]=s=>a.workplace_address=s),type:"text",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-transparent transition",placeholder:"예: 서울시 강남구"},null,512),[[p,a.workplace_address]])]),t("div",_e,[e[14]||(e[14]=t("label",{for:"industry",class:"block text-sm font-semibold text-gray-900 mb-2"}," 업종 ",-1)),n(t("input",{id:"industry","onUpdate:modelValue":e[2]||(e[2]=s=>a.industry=s),type:"text",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-transparent transition",placeholder:"예: 음식료, 소매, 교육"},null,512),[[p,a.industry]])]),t("div",me,[e[16]||(e[16]=t("label",{for:"employment_type",class:"block text-sm font-semibold text-gray-900 mb-2"},[g(" 고용형태 "),t("span",{class:"text-red-500"},"*")],-1)),n(t("select",{id:"employment_type","onUpdate:modelValue":e[3]||(e[3]=s=>a.employment_type=s),required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-transparent transition"},[...e[15]||(e[15]=[H('<option value="" data-v-34177b69>-- 선택하세요 --</option><option value="알바" data-v-34177b69>알바</option><option value="정규직" data-v-34177b69>정규직</option><option value="계약직" data-v-34177b69>계약직</option><option value="프리랜서" data-v-34177b69>프리랜서</option><option value="기타" data-v-34177b69>기타</option>',6)])],512),[[G,a.employment_type]])]),t("div",be,[e[18]||(e[18]=t("label",{for:"hourly_rate",class:"block text-sm font-semibold text-gray-900 mb-2"},[g(" 시급 "),t("span",{class:"text-red-500"},"*")],-1)),t("div",ye,[n(t("input",{id:"hourly_rate","onUpdate:modelValue":e[4]||(e[4]=s=>a.hourly_rate=s),type:"number",required:"",min:"0",step:"100",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-transparent transition",placeholder:"예: 11500"},null,512),[[p,a.hourly_rate,void 0,{number:!0}]]),e[17]||(e[17]=t("span",{class:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500"},"원",-1))])]),t("div",ce,[e[20]||(e[20]=t("label",{for:"weekly_hours",class:"block text-sm font-semibold text-gray-900 mb-2"},[g(" 주당 근로시간 "),t("span",{class:"text-red-500"},"*")],-1)),t("div",ge,[n(t("input",{id:"weekly_hours","onUpdate:modelValue":e[5]||(e[5]=s=>a.weekly_hours=s),type:"number",required:"",min:"0",max:"168",step:"0.5",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-transparent transition",placeholder:"예: 30"},null,512),[[p,a.weekly_hours,void 0,{number:!0}]]),e[19]||(e[19]=t("span",{class:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500"},"시간",-1))])]),t("div",fe,[e[22]||(e[22]=t("label",{for:"daily_hours",class:"block text-sm font-semibold text-gray-900 mb-2"}," 1일 근로시간 ",-1)),t("div",xe,[n(t("input",{id:"daily_hours","onUpdate:modelValue":e[6]||(e[6]=s=>a.daily_hours=s),type:"number",min:"0",max:"24",step:"0.5",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-transparent transition",placeholder:"예: 8"},null,512),[[p,a.daily_hours,void 0,{number:!0}]]),e[21]||(e[21]=t("span",{class:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500"},"시간",-1))])]),t("div",ve,[e[23]||(e[23]=t("label",{for:"start_date",class:"block text-sm font-semibold text-gray-900 mb-2"},[g(" 근로 시작일 "),t("span",{class:"text-red-500"},"*")],-1)),n(t("input",{id:"start_date","onUpdate:modelValue":e[7]||(e[7]=s=>a.start_date=s),type:"date",required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-transparent transition"},null,512),[[p,a.start_date]])]),t("div",we,[e[24]||(e[24]=t("label",{for:"end_date",class:"block text-sm font-semibold text-gray-900 mb-2"}," 근로 종료일 ",-1)),n(t("input",{id:"end_date","onUpdate:modelValue":e[8]||(e[8]=s=>a.end_date=s),type:"date",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-transparent transition"},null,512),[[p,a.end_date]]),e[25]||(e[25]=t("p",{class:"text-xs text-gray-500 mt-1"},"현재 재직 중인 경우 비워두세요.",-1))]),t("div",ke,[t("div",he,[n(t("input",{id:"has_paid_weekly_holiday","onUpdate:modelValue":e[9]||(e[9]=s=>a.has_paid_weekly_holiday=s),type:"checkbox",class:"w-4 h-4 rounded border-gray-300 text-brand-600 focus:ring-2 focus:ring-brand-500"},null,512),[[V,a.has_paid_weekly_holiday]]),e[26]||(e[26]=t("label",{for:"has_paid_weekly_holiday",class:"text-sm font-medium text-gray-900"}," 주휴수당 대상 ",-1)),e[27]||(e[27]=t("p",{class:"text-xs text-gray-500 ml-auto"},"주 1일 이상 근무 시 적용",-1))])]),t("div",Ve,[t("div",$e,[n(t("input",{id:"is_severance_eligible","onUpdate:modelValue":e[10]||(e[10]=s=>a.is_severance_eligible=s),type:"checkbox",class:"w-4 h-4 rounded border-gray-300 text-brand-600 focus:ring-2 focus:ring-brand-500"},null,512),[[V,a.is_severance_eligible]]),e[28]||(e[28]=t("label",{for:"is_severance_eligible",class:"text-sm font-medium text-gray-900"}," 퇴직금 대상 ",-1)),e[29]||(e[29]=t("p",{class:"text-xs text-gray-500 ml-auto"},"1년 이상 근무 시 적용",-1))])]),t("div",Ue,[t("div",Se,[n(t("input",{id:"is_current","onUpdate:modelValue":e[11]||(e[11]=s=>a.is_current=s),type:"checkbox",class:"w-4 h-4 rounded border-gray-300 text-brand-600 focus:ring-2 focus:ring-brand-500"},null,512),[[V,a.is_current]]),e[30]||(e[30]=t("label",{for:"is_current",class:"text-sm font-medium text-gray-900"}," 현재 재직 중 ",-1))])]),t("div",Fe,[e[31]||(e[31]=t("h2",{class:"text-lg font-semibold text-gray-900 mb-2"},"주간 근무 스케줄",-1)),q(re,{employeeId:((i=C(d))==null?void 0:i.id)||0},null,8,["employeeId"])]),w.value?(b(),m("div",Ee,[t("p",Ce,I(w.value),1)])):E("",!0),t("div",Ie,[t("button",{type:"button",onClick:B,class:"px-6 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors duration-200"}," 취소 "),t("button",{type:"submit",disabled:u.value,class:"px-6 py-2 text-sm font-medium text-white bg-brand-600 rounded-lg hover:bg-brand-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200 flex items-center gap-2"},[u.value?(b(),m("span",Ne,"저장 중...")):(b(),m("span",De,I(C(d)?"저장하기":"등록하고 선택하기"),1))],8,je)])],32)]),q(P,{name:"fade"},{default:K(()=>[F.value?(b(),m("div",Me," 저장되었습니다! ")):E("",!0)]),_:1})])}}}),Ae=X(qe,[["__scopeId","data-v-34177b69"]]);export{Ae as default};
